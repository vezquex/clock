<!doctype html>
<meta charset='utf-8'/>
<meta name='viewport' content='width=device-width, initial-scale=1'/>
<title>
	Biel Dive Watch
</title>
<style type='text/css'>
	:root {
		accent-color: var(--accent);
	}
	body, option {
		background: #000;
	}
	body {
		overflow: hidden;
	}
	body, input, select {
		color: #FFF;
		font-family: sans-serif;
		font-size: 1em;
		margin: 0;
	}
	label {
		display: flex;
	}
	input, select, .label {
		background: 0;
		border: 0;
		opacity: 0.5;
		padding: .5em;
	}
	select {
		flex-grow: 1;
	}
	.abs {
		position:absolute;
	}
	.img-full {
		display: block;
		height: auto;
		position: absolute;
		width: auto;
	}
	.svg {
		margin: 0 auto;
		max-height: 100vh;
	}
	.flex {
		display: flex;
		flex-direction: column;
	}
	.wide {
		width: 100vw;
	}
	.bold {
		font-weight:700;
	}
	.mono {font-family: "Roboto Mono", monospace;}
	.sans {font-family: Roboto, sans-serif; letter-spacing: 3px;}
	.cursive {font-family: cursive; letter-spacing: -1px; font-style:italic; }
	text {text-anchor:middle;}
	.info {font-size: 36px;}
</style>
<div style='position:absolute;top:0;bottom:0;left:0;right:0;display:flex;align-content: center;'>
<svg version="1.1" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class='svg'>
<rect id="canvas" x="0" y="0" width="2048" height="2048" fill="none"/>
<circle id="edge" style="fill:var(--edge);opacity:1.0;" r="1024" cx="1024" cy="1024"/>
<circle id="bezel" style="fill:var(--bezel);opacity:1.0;" r="968" cx="1024" cy="1024"/>
<circle id="dial" style="fill:var(--dial);" r="780" cx="1024" cy="1024"/>

<path id="twelve_bezel" style="stroke:var(--mark);stroke-width:16;fill:none;" d="M 1024,220 l -108,-140 q 108,-16 216,0z"/>
<circle id="twelve_pip" style="fill:var(--mark);stroke:var(--edge);stroke-width:8;" r="32" cx="1024" cy="132"/>
<g style="fill:var(--mark);font:120px sans-serif;">
	<text id="ten" transform="rotate(55 1024 1024) translate(1024 176) scale(2.5 1)">
		1
	</text>
	<text id="ten" transform="rotate(63 1024 1024) translate(1024 176) scale(3 1)">
		0
	</text>
	<text id="ten" transform="rotate(114 1024 1024) translate(1024 176) scale(2.5 1)">
		2
	</text>
	<text id="ten" transform="rotate(125 1024 1024) translate(1024 176) scale(3 1)">
		0
	</text>
	<text id="ten" transform="rotate(174 1024 1024) translate(1024 176) scale(3 1)">
		3
	</text>
	<text id="ten" transform="rotate(186 1024 1024) translate(1024 176) scale(3 1)">
		0
	</text>
	<text id="ten" transform="rotate(234 1024 1024) translate(1024 176) scale(3 1)">
		4
	</text>
	<text id="ten" transform="rotate(246 1024 1024) translate(1024 176) scale(3 1)">
		0
	</text>
	<text id="ten" transform="rotate(294 1024 1024) translate(1024 176) scale(3 1)">
		5
	</text>
	<text id="ten" transform="rotate(306 1024 1024) translate(1024 176) scale(3 1)">
		0
	</text>
</g>
<text x="1024" y="700" style="fill:var(--text);font:100px Courier, monospace;">
	Θ
</text>
<text x="1036" y="780" style="fill:var(--text);font:100px Courier, monospace;">
	THETA
</text>
<text class="cursive"
style="fill:var(--highlight);font-size:50px;"
transform="translate(1030 855) scale(1.5 1)">
	<tspan style="font-size:1.5em;">S</tspan><tspan dy="-10">uperstar</tspan>
</text>
<text x="1032" y="1138" class="sans info" style="opacity:.3;fill:var(--text);font-weight:lighter;font-size:44px;">
	[SiO<tspan dy="10">2</tspan><tspan dy="-10">]</tspan>
</text>
<text x="1024" y="908" class="sans info" style="fill:var(--text);">
	UNDERWATER
</text>
<text x="1032" y="1258" class="sans info" style="fill:var(--text);">
	JAVASCRIPT
</text>
<text x="1024" y="1310" class="sans info" style="fill:var(--text);">
	VIRTUAL CHRONOMETER
</text>
<text x="1028" y="1362" class="sans info" style="fill:var(--text);">
	300m ≈ 1000ft
</text>
<path id="curve"
pathLength="2"
d="
M 1024, 254
a 770,770 0 1,0 5,0
" fill='none'/>
<text class="mono" style="fill:var(--text);font-size:24px;">
	<textPath xlink:href="#curve"	startOffset="1"
	>HTML<tspan style="font-size:180px;"> </tspan>MADE</textPath>
</text>
</svg>
<canvas id='face-static' class='abs'></canvas>
<canvas id='face' class='abs'></canvas>
</div>
<div class='abs flex wide' >
	<input id='offset' title='Demo Offset' value='0' type='range' max='86400000' step='60000' onChange='synchronize()'>
	<label>
		<span class='label'>Theme</span>
		<select id='theme' onChange='setTheme(this.value)'></select>
	</label>
</div>

<script type='text/javascript'>
const bps = 4
const _ = void 0

let palettes
const color_palettes = {
	bezel: '#000000',
	dial: '#000000',
	edge: '#C0C0C0',
	highlight: '#C00000',
	mark: '#FFFFFF',
	text: '#FFFFFF',
}
const themes = {
	'Black': {},
	'Blue': {
		bezel: '#001830',
		dial: '#002040',
	},
	'Cyan': {
		bezel: '#003030',
		dial: '#004040',
	},
	'Gray': {
		bezel: '#303030',
		dial: '#404040',
	},
	'Green': {
		bezel: '#003000',
		dial: '#004000',
	},
	'Purple': {
		bezel: '#300030',
		dial: '#400040',
	},
	'Red': {
		bezel: '#300000',
		dial: '#400000',
	},
}
const height = 128
const width = height
const half = width / 2
const bezel_r = 50
const bezel_mark_len = 9.5
const bezel_mark_thick = .75
const bezel_minute_len = bezel_mark_thick * 2
const dash = 1.2
const dial_r = half * 780/1024
const hour_r = 40
const hour_r_rect = 37
const hour_len = 6
const hour_radius = 4
const hour_thick = 2.25
const minute_len = 2.25
const minute_r = half * 766/1024
const minute_thick = 0.2
const thick = .2
const tw_gap = 3

// zoom
let z = 1

const tau = 2 * Math.PI
const tau_4 = tau / 4
const {cos, sin} = Math

for(k in themes){
	themes[k] = Object.assign({}, color_palettes, themes[k])
}
const colors = Object.keys(color_palettes)
document.getElementById('theme').innerHTML = Object.keys(themes).map(
	t => `<option value='${t}'>${t.replaceAll('_',' ')}</option>`
).join('')


const face = document.getElementById('face')
const fc = face.getContext('2d')

const can = document.getElementById('face-static')
const c = can.getContext('2d')

const faces = [face, can]
const faces_c = [fc, c]

function resize(){
	const canvas_el = document.getElementById('canvas')
	const rect = canvas_el.getBoundingClientRect()
	const scale = window.devicePixelRatio || 1
	z = Math.min(
		(rect.height / height),
		(rect.width / width),
	)
	faces.forEach(can =>{
		can.height = height * scale * z
		can.width = width * scale * z
		can.style.left = rect.x + 'px'
		can.style.top = rect.y + 'px'
		can.style.height = rect.height+'px'
		can.style.width = rect.width+'px'
	})
	faces_c.forEach(
		c => c.scale(scale, scale)
	)
	display_static()
	synchronize()
}
window.addEventListener('resize', resize)

const offset_el = document.getElementById('offset')

function setTheme(theme){
	palettes = themes[theme]
	document.querySelector(`#theme [value=${theme}]`).selected = true
	colors.forEach(color => {
		document.documentElement.style.setProperty('--'+color, palettes[color])
	})
	display_static()
	synchronize()
}

const delay = 1000 / bps
function synchronize(){
	window.clearTimeout(window.synchronizeTimeout)
	const offset = Number(offset_el.value)
	let t = new Date(Date.now() + offset)
	// t = new Date(2020,0,8,10,7,37,0)
	display(t)
	const r = delay - (t % delay)
	window.synchronizeTimeout = window.setTimeout(synchronize, r)
}

function shapec(c, path, x = 0, y = 0, m = 1){
	m = m*z
	c.beginPath()
	c.moveTo((path[0][0] + x)*m, (path[0][1] + y)*m)
	for(i=1; i<path.length; ++i){
		c.lineTo((path[i][0] + x)*m, (path[i][1] + y)*m)
	}
	c.fill()
}
const shape = shapec.bind(null, c)

function circle(r, x, y, m = 1){
	m = m*z
	c.beginPath()
	c.arc(x*m, y*m, r*m, 0, tau)
	c.fill()
}

const paths = []

const locale = 'en-us'

function rot(a, [x,y]){
	return [
		x * cos(a) + y * sin(a),
		y * cos(a) - x * sin(a),
	]
}

const bezel_index = [
	[0, -bezel_mark_thick],
	[bezel_mark_len, -bezel_mark_thick],
	[bezel_mark_len, bezel_mark_thick],
	[0, bezel_mark_thick],
	[0, -bezel_mark_thick],
]
const bezel_minute = [
	[bezel_minute_len, -bezel_mark_thick],
	[0, -bezel_mark_thick],
	[0, bezel_mark_thick],
	[bezel_minute_len, bezel_mark_thick],
	[bezel_minute_len, -bezel_mark_thick],
]

function polygon(sides, radius = 1, rot = tau_4){
	return Array(sides).fill().map((_,i)=>([
		radius * cos(i * tau / sides - rot),
		radius * sin(i * tau / sides - rot),
	]))
}
const pentagon_hour = polygon(5, 5, 0)
const triangle_minute = polygon(3, 5, 0)
const triangle_minute_lume = polygon(3, 3, 0)

function display(t){
	const hours = t.getHours()
	const minutes = t.getMinutes()
	const seconds = t.getSeconds() + t.getMilliseconds() / 1000
	// const day_of_month = (t.getDate()+'').padStart(2)
	// const weekday = t.toLocaleString(locale, {weekday:'short'}).toUpperCase().slice(0,2)

	fc.fillStyle = palettes.mark
	fc.strokeStyle = palettes.edge
	fc.save()
	fc.lineWidth = .5*z
	fc.clearRect(0, 0, width*z, height*z)
	fc.translate(half*z, half*z)
	fc.rotate(-tau/4)

	const hr = hours % 12

	face.innerText = `The time is ${hr} hours, ${(minutes+'').padStart(2, '0')} minutes, and ${seconds} seconds`;

	// hour hand
	fc.save()
	fc.rotate(
		(hr / 12 + minutes / 720 + seconds / 43200) * tau,
	)
	fc.fillStyle = palettes.edge
	shapec(
		fc,
		[
			[0, 0],
			[6, 0],
			[6, 1],
			[0, 1],
		],
		0, -.5,
	)
	shapec(
		fc,
		[
			[0, 0],
			[0, 3],
			[1.5, 3],
			[1.5, 0],
		],
		6, -1.5,
	)
	shapec(
		fc,
		[
			[0, 0],
			[21, -3],
			[21, 0],
			[0, 1.2],
		],
		6, -1.8,
	)
	shapec(
		fc,
		[
			[0, 0],
			[21, 3],
			[21, 0],
			[0, -1.2],
		],
		6, 1.8,
	)
	shapec(fc, pentagon_hour, 25.5)
	fc.fillStyle = palettes.mark
	fc.beginPath()
	fc.arc(25.5*z, 0, 2.75*z, 0, tau)
	fc.fill()
	fc.restore()

	// minute hand
	fc.save()
	fc.rotate((minutes / 60 + seconds / 3600) * tau)
	fc.fillStyle = palettes.edge
	shapec(
		fc,
		[
			[0, 0],
			[6, 0],
			[6, 1],
			[0, 1],
		],
		0, -.5,
	)
	shapec(
		fc,
		[
			[0, 0],
			[0, 3],
			[1.5, 3],
			[1.5, 0],
		],
		6, -1.5,
	)
	shapec(
		fc,
		[
			[0, 0],
			[31.5, -2.5],
			[32, 0],
			[0, 1.2],
		],
		6, -1.8,
	)
	shapec(
		fc,
		[
			[0, 0],
			[31.5, 2.5],
			[32, 0],
			[0, -1.2],
		],
		6, 1.8,
	)
	shapec(fc, triangle_minute, 40)
	fc.fillStyle = palettes.mark
	shapec(fc, triangle_minute_lume, 40)
	fc.restore()

	// center post
	fc.beginPath()
	fc.arc(0, 0, 4*z, 0, tau)
	fc.fillStyle = palettes.edge
	fc.fill()

	// second hand
	fc.save()
	fc.lineWidth = .5*z
	fc.rotate(seconds * tau / 60)
	
	fc.beginPath()
	fc.moveTo(-15*z, 0)
	fc.lineTo(45.6*z, 0)
	fc.strokeStyle = palettes.edge
	fc.stroke()

	fc.beginPath()
	fc.moveTo(35.6*z, 0)
	fc.lineTo(45.6*z, 0)
	fc.strokeStyle = palettes.highlight
	fc.stroke()

	fc.beginPath()
	fc.arc(33.6*z, 0, 2*z, 0, tau, true)
	fc.fillStyle = palettes.mark
	fc.strokeStyle = palettes.edge
	fc.fill()
	fc.stroke()

	fc.beginPath()
	fc.lineWidth = 2*z
	fc.moveTo(-17*z, 0)
	fc.lineTo(-8*z, 0)
	fc.strokeStyle = palettes.edge
	fc.stroke()

	fc.restore()
	fc.restore()
}

function display_static(){
	c.clearRect(0, 0, width*z, height*z)

	c.fillStyle = palettes.mark
	c.strokeStyle = palettes.mark
	c.lineWidth = .5 * z

	;[0,2,4,6,8,10].forEach(i => {
		const a = -i*tau/12
		shape(
			bezel_index.map(v => rot(a, v)),
			half + (bezel_r * cos(-a)),
			half + (bezel_r * sin(-a)),
		)
	})
	;Array(60).fill().map((_, i) => i)
	.filter(x => x % 5)
	.forEach(i => {
		const a = -(i+45)*tau/60
		circle(
			bezel_mark_thick,
			half + (bezel_r * cos(-a)),
			half + (bezel_r * sin(-a)),
		)}
	)
	;Array(59).fill().map((_, i) => i)
	.filter(x => !((x+1) % 5))
	.forEach(i => {
		const a = -(1+i+45)*tau/60
		shape(
			bezel_minute.map(v => rot(a, v)),
			half + (bezel_r * cos(-a)),
			half + (bezel_r * sin(-a)),
		)
	})
	;[
		0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,
		30,
		32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
	]
	.forEach(
		(i) => {
			const a = -i*tau/60 + tau/4
			shape(
				[
					rot(a, [0, -minute_thick]),
					rot(a, [-minute_len, -minute_thick]),
					rot(a, [-minute_len, minute_thick]),
					rot(a, [0, minute_thick]),
				],
				half + (minute_r * cos(-a)),
				half + (minute_r * sin(-a)),
			)
		}
	)
	;[29, 31].forEach(
		(i) => {
			const a = -i*tau/60 + tau/4
			const l = 1
			const r = minute_r - minute_len
			shape(
				[
					rot(a, [0,-minute_thick]),
					rot(a, [l,-minute_thick]),
					rot(a, [l,minute_thick]),
					rot(a, [0,minute_thick]),
				],
				half + (r * cos(-a)),
				half + (r * sin(-a)),
			)
		}
	)
	c.fillStyle = palettes.mark
	c.lineCap = 'square'
	c.strokeStyle = palettes.edge
	;[1,2,4,5,7,8,10,11].forEach(i => {
		circle(
			hour_radius,
			half + (hour_r * cos(i*tau/12)),
			half + (hour_r * sin(i*tau/12)),
		)
		c.stroke()
	})
	;[0,3,6].forEach(i => {
		const a = -i*tau/12
		shape(
			[
				rot(a, [-hour_len,-hour_thick]),
				rot(a, [hour_len,-hour_thick]),
				rot(a, [hour_len,hour_thick]),
				rot(a, [-hour_len,hour_thick]),
				rot(a, [-hour_len,-hour_thick]),
			],
			half + (hour_r_rect * cos(-a)),
			half + (hour_r_rect * sin(-a)),
		)
		c.stroke()
	})
	;[-1,1].forEach(i => {
		const a = -9/12*tau
		const gap = i * tw_gap
		shape(
			[
				rot(a, [-hour_len,-hour_thick + gap]),
				rot(a, [hour_len,-hour_thick + gap]),
				rot(a, [hour_len,hour_thick + gap]),
				rot(a, [-hour_len,hour_thick + gap]),
				rot(a, [-hour_len,-hour_thick + gap]),
			],
			half + (hour_r_rect * cos(-a)),
			half + (hour_r_rect * sin(-a)),
		)
		c.stroke()
	})
	// minute arcs
	c.lineWidth = 2 * minute_thick * z
	c.strokeStyle = palettes.mark
	;[
		1, 6, 11, 16, 21, 36, 41, 46, 51, 56,
	]
	.forEach(i => {
		const a = (i + 45)* tau/60
		c.beginPath()
		c.arc(half*z, half*z, (minute_r - minute_thick)*z, a, a + tau / 20)
		c.stroke()
	})
	;[
		26, 32,
	]
	.forEach(i => {
		const a = (i + 45)* tau/60
		c.beginPath()
		c.arc(half*z, half*z, (minute_r - minute_thick)*z, a, a + tau / 30)
		c.stroke()
	})
}
setTheme('Blue')
resize()
</script>
