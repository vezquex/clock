<!doctype html>
<meta charset='utf-8'/>
<meta name='viewport' content='width=device-width, initial-scale=1'/>
<title>
	Retro Watch 168
</title>
<style type='text/css'>
	*, *::before, *::after {
		box-sizing: border-box;
	}
	:root {
		--accent: #808080;
		accent-color: var(--accent);
		color-scheme: dark;
	}
	body, option {
		background: #000;
	}
	body {
		overflow: hidden;
	}
	body, input, select {
		color: #FFF;
		font-family: sans-serif;
		font-size: 1em;
		margin: 0;
	}
	details {
		opacity: 0.5;
	}
	input, select, .label, summary {
		padding: .5em;
	}
	input {
		width: 100%;
	}
	label {
		display: flex;
	}
	select {
		min-width: 8rem;
	}
	summary {
		cursor:pointer;
		list-style: none;
		user-select: none;
	}
	.abs {
		position:absolute;
	}
	.img-full {
		display: block;
		height: auto;
		position: absolute;
		width: auto;
	}
	.svg {
		margin: 0 auto;
		max-height: 100vh;
	}
	.flex {
		display: flex;
		flex-direction: column;
	}
	.wide {
		width: 100vw;
	}
	.bold {
		font-weight:700;
	}
	.button-label {
		font-size:140px;
		letter-spacing:10px;
	}
</style>
<div contenteditable spellcheck="false" style='position:absolute;top:0;bottom:0;left:0;right:0;display:flex;align-content: center;'>
<svg version="1.1" viewBox="0 0 3200 3200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class='svg'>
<filter id='inset-shadow'>
	<feOffset dx='-20' dy='20'/>
	<feGaussianBlur stdDeviation='10' result='offset-blur'/>
	<feComposite result='inverse' operator='out' in='SourceGraphic' in2='offset-blur'/>
	<feFlood flood-color='#000' flood-opacity='.95' result='color'/>
	<feComposite result='shadow' operator='in' in='color' in2='inverse'/>
	<feComposite operator='over' in='shadow' in2='SourceGraphic'/>
</filter>
<g id="Vectors">
<path id="Outer_Ring" style="fill:var(--bg);stroke:var(--outer_ring);" stroke-width="48" d="m654 84c-107.9 0-125.6 10.86-178 42-99.24 58.97-169.5 160.3-231 258-55.99 88.89-97.35 188.6-121 291-47.44 205.3-38 631-38 631s-15.02 543.3 33.83 771.4c23.81 111.2 51.72 164.5 68.18 192.3 81.62 137.7 135.8 290.9 288 384.3 5.375 3.302 62.14 42 178 42h1892c115.9 0 172.6-38.7 178-42 152.1-93.45 206.4-246.6 288-384.3 16.46-27.77 44.37-81.13 68.18-192.3 48.85-228.1 33.83-771.4 33.83-771.4s9.444-425.7-38-631c-23.65-102.4-65.01-202.1-121-291-61.53-97.67-131.8-199-231-258-52.41-31.14-70.14-42-178-42h-946z"/>
<path id="Inner_Ring" style="stroke:var(--inner_ring);" transform="matrix(.9553 0 0 .9553 71.58 62.19)" d="m654 84c-107.9 0-125.6 10.86-178 42-99.24 58.97-169.5 160.3-231 258-55.99 88.89-97.35 188.6-121 291-47.44 205.3-38 631-38 631s-15.02 543.3 33.83 771.4c23.81 111.2 51.72 164.5 68.18 192.3 81.62 137.7 135.8 290.9 288 384.3 5.375 3.302 62.14 42 178 42h1892c115.9 0 172.6-38.7 178-42 152.1-93.45 206.4-246.6 288-384.3 16.46-27.77 44.37-81.13 68.18-192.3 48.85-228.1 33.83-771.4 33.83-771.4s9.444-425.7-38-631c-23.65-102.4-65.01-202.1-121-291-61.53-97.67-131.8-199-231-258-52.41-31.14-70.14-42-178-42h-946z" fill="none" stroke-width="24"/>
<path id="Banner" d="m610 520h2074v226h-2074l-134-113z" style="fill:var(--banner);"/>
<rect id="LCD" style="filter:url(#inset-shadow);" x="540" y="850" width="2130" height="1050" rx="100"/>
<path id="Rule" d="m420 2250h2366l-24 34h-2314z" style="fill:var(--gray);"/>
<g style="fill:var(--highlight);">
<path id="LPoint" d="m764 2078 129-32-20 114-117-40z"/>
<path id="RPoint" d="m2429 2128-129 32 20-114 117 40z"/>
<circle id="ULCircle" cx="370" cy="754" r="50"/>
<circle id="DRCircle" cx="2850" cy="2050" r="50"/>
<circle id="DLCircle" cx="370" cy="2050" r="50"/>
</g>
</g>
<text x="620" y="440" style="fill:var(--brand);font-size:200px;font-weight:700;letter-spacing:45px;">
	OASIS
</text>
<text x="2670" y="420" style="fill:var(--alchro);font-size:110px;font-weight:700;letter-spacing:23px;text-anchor:end;">
	ALARM CHRONO
</text>
<text x="1600" y="680" style="fill:var(--gray);font-size:150px;letter-spacing:21px;font-style:italic;font-variant:small-caps;text-anchor:middle;">
	<tspan class='bold'>E</tspan>lectro<tspan class='bold'>L</tspan>uminescence
</text>
<text style="fill:var(--gray);transform: translate(300px, 860px) rotate(90deg);" class="button-label">
	LIGHT
</text>
<text style="fill:var(--gray);transform: translate(300px, 1960px) rotate(90deg);text-anchor:end;" class="button-label">
	MODE
</text>
<text x="1600" y="2168" style="fill:var(--highlight);font-size:180px;letter-spacing:25px;font-style:italic;font-weight:700;text-anchor:middle;">
	ILLUMINATED
</text>
<text x="1650" y="2476" style="fill:var(--water);font-size:150px;letter-spacing: 46px;font-weight:700;text-anchor:middle;">
	WATER RESIST
</text>
<text style="fill:var(--gray);transform: translate(2900px, 1922px) rotate(-90deg);font-size:140px;letter-spacing:16px;" class="button-label">
	START/STOP
</text>
<text x="920" y="1186" style="fill:var(--accent);font-size:120px;font-weight:700;letter-spacing:8px;">
	24H
</text>
</svg>
</div>
<details class='abs flex wide'>
	<summary title='Settings'>â˜°</summary>
	<label>
		<span class='label'>Offset</span>
		<input id='offset' value='0' type='range' max='86400000' step='100000' onChange='synchronize()'>
	</label>
	<label>
		<span class='label'>Theme</span>
		<select id='theme' onChange='setTheme(this.value)'></select>
	</label>
</details>


<canvas id='face' class='abs'></canvas>

<script type='text/javascript'>
const _ = void 0

let palettes
const color_palettes = {
	accent: '#242224',
	alchro: '#8E7853',
	background: '#BFD4D5',
	banner: '#034A82',
	bg: '#000',
	brand: '#B0B0B0',
	dark_label: '#868EA1',
	gray: '#B0B0B0',
	highlight: '#C6311B',
	inner_ring: '#B0B0B0',
	outer_ring: '#034A82',
	water: '#8E7853',
}
const themes = {
	'Accents': {
		alchro: '#E1DB72',
		banner: '#314254',
		brand: '#E1DB72',
		highlight: '#E1DB72',
		inner_ring: color_palettes.gray,
		outer_ring: '#314254',
		water: color_palettes.gray,
	},
	'Cyan': {
		alchro: '#14667B',
		banner: 'none',
		bg: '#2EDCD3',
		brand: '#5C8797',
		gray: '#14667B',
		highlight: '#14667B',
		inner_ring: '#14667B',
		outer_ring: 'none',
		water: '#14667B',
	},
	'Dark': {
		alchro: color_palettes.gray,
		banner: '#2F383F',
		highlight: color_palettes.gray,
		outer_ring: 'none',
		water: color_palettes.gray,
	},
	'Dark_Negative': {
		accent: '#98A29A',
		alchro: color_palettes.dark_label,
		background: '#2D2C31',
		banner: '#000',
		brand: '#E0E0E0',
		gray: color_palettes.dark_label,
		highlight: color_palettes.dark_label,
		inner_ring: color_palettes.dark_label,
		outer_ring: 'none',
		water: color_palettes.dark_label,
	},
	'Gold': {
		accent: '#202020',
		alchro: '#000',
		background: '#A2A79A',
		banner: 'rgba(0,0,0,.2)',
		bg: '#A89C60',
		brand: '#000',
		gray: '#000',
		highlight: '#49242F',
		inner_ring: '#000',
		outer_ring: 'none',
		water: '#000',
	},
	'Gray': {
		alchro: '#3E4449',
		banner: 'rgba(0,0,0,.2)',
		bg: '#B9BFC4',
		brand: '#3E4449',
		gray: '#3E4449',
		highlight: '#3E4449',
		inner_ring: '#3E4449',
		outer_ring: 'none',
		water: '#3E4449',
	},
	'Standard': {
	},
	'Standard_Light': {
		background: '#05B3E6',
	},
}
for(k in themes){
	themes[k] = Object.assign({}, color_palettes, themes[k])
}
const colors = Object.keys(color_palettes)
document.getElementById('theme').innerHTML = Object.keys(themes).map(t => `<option value='${t}'>${t.replaceAll('_',' ')}</option>`).join('')


const can = document.getElementById('face')
const c = can.getContext('2d')

const height = 49
const width = 100
const char_height = 10
const char_width = 14
const grid_w = char_width
const grid_w2 = grid_w * 2

// zoom
let z = 1

function resize(){
	const lcd_el = document.getElementById('LCD')
	const rect = lcd_el.getBoundingClientRect()
	const scale = window.devicePixelRatio || 1
	z = Math.min(
		(rect.height / height),
		(rect.width / width),
	)
	can.height = height * scale * z
	can.width = width * scale * z
	can.style.left = rect.x + 'px'
	can.style.top = rect.y + 'px'
	can.style.height = rect.height+'px'
	can.style.width = rect.width+'px'
	can.style.borderRadius = z*5 + 'px'
	c.scale(scale, scale)
	synchronize()
}
window.addEventListener('resize', resize)

const offset_el = document.getElementById('offset')

function setTheme(theme){
	palettes = themes[theme]
	const lcd_el = document.getElementById('LCD')
	lcd_el.style.fill = palettes.background
	document.querySelector(`#theme [value=${theme}]`).selected = true
	colors.forEach(color => {
		document.documentElement.style.setProperty('--'+color, palettes[color])
	})
	synchronize()
}

// display at the start of each second
function synchronize(){
	window.clearTimeout(window.synchronizeTimeout)
	const offset = Number(offset_el.value)
	let t = new Date(Date.now() + offset)
	display(t)
	const r = 1000 - (t % 1000)
	window.synchronizeTimeout = window.setTimeout(synchronize, r)
}

function zeropad2(s){
	return ('0' + s).slice(-2)
}

function shape(path, x, y, m = 1){
	m = m*z
	c.beginPath()
	c.moveTo((path[0][0] + x)*m, (path[0][1] + y)*m)
	for(i=1; i<path.length; ++i){
		c.lineTo((path[i][0] + x)*m, (path[i][1] + y)*m)
	}
	c.fill()
}

const tau = 2 * Math.PI
function circle(r, x, y, m = 1){
	m = m*z
	c.beginPath()
	c.arc(x*m, y*m, r*m, 0, tau)
	c.fill()
}
function colon(x, y, m = 1){
	circle(1, x, y+5, m)
	circle(1, x, y+9, m)
}

const full_path_segs = {
	db: [[4,11.625], [6,11.625], [6,9], [5,8.25], [4,9]],
	dc: [[.25,14], [9.75,14], [7.75,12], [2.25,12]],
	dl: [[0,13.75], [2,11.75], [2,8.25], [1,7.25], [0,8.25]],
	dr: [[10,13.75], [8,11.75], [8,8.25], [9,7.25], [10,8.25]],
	lt: [[-.375,0], [-4,0], [-3,2], [-.375,2]],
	mc: [[1.25, 7], [2.25,6], [7.75,6], [8.75, 7], [7.75,8], [2.25,8]],
	ub: [[4,2.375], [6,2.375], [6,5], [5,5.75], [4,5]],
	uc: [[.25,0], [9.75,0], [7.75,2], [2.25,2]],
	ul: [[0,.25], [2,2.25], [2,5.75], [1,6.75], [0,5.75]],
	ur: [[10,.25], [8,2.25], [8,5.75], [9,6.75], [10,5.75]],
}
const narrow_path_segs = {
	db: [[3,11.625], [5,11.625], [5,9], [4,8.25], [3,9]],
	dc: [[.25,14], [7.75,14], [5.75,12], [2.25,12]],
	dl: [[0,13.75], [2,11.75], [2,8.25], [1,7.25], [0,8.25]],
	dr: [[8,13.75], [6,11.75], [6,8.25], [7,7.25], [8,8.25]],
	lt: [[-.375,0], [-4,0], [-3,2], [-.375,2]],
	mc: [[1.25, 7], [2.25,6], [5.75,6], [6.75, 7], [5.75,8], [2.25,8]],
	ub: [[3,2.375], [5,2.375], [5,5], [4,5.75], [3,5]],
	uc: [[.25,0], [7.75,0], [5.75,2], [2.25,2]],
	ul: [[0,.25], [2,2.25], [2,5.75], [1,6.75], [0,5.75]],
	ur: [[8,.25], [6,2.25], [6,5.75], [7,6.75], [8,5.75]],
}

const seg_order = ['ur', 'ul', 'uc', 'dr', 'dl', 'dc', 'mc', 'ub', 'db', 'lt']
const segs = seg_order.map(k => full_path_segs[k])
const narrow_segs = seg_order.map(k => narrow_path_segs[k])

const char_masks = {
	'0': 0b111111,
	'1': 0b1001,
	'2': 0b1110101,
	'3': 0b1101101,
	'4': 0b1001011,
	'5': 0b1101110,
	'6': 0b1111110,
	'7': 0b1101,
	'8': 0b1111111,
	'9': 0b1101111,
	' ': 0,
	'-': 0b100000000,
	':': 0b110000000,
	'A': 0b1011111,
	'E': 0b1110110,
	'F': 0b1010110,
	'H': 0b1011011,
	'L': 0b0110010,
	'M': 0b110011111,
	'O': 0b111111,
	'R': 0b1001011111,
	'S': 0b1101110,
	'T': 0b110000100,
	'T2': 0b1000010110,
	'U': 0b111011,
	'W': 0b100111011,
	'?': 0b1111111111,
}

function mask_segs(mask, segs){
	let s = []
	let i = 0
	let i_mask = 1
	while(i_mask <= mask){
		if(mask & i_mask){
			s.push(segs[i])
		}
		++i
		i_mask = i_mask << 1
	}
	return s
}

const paths = []

const char_paths = Object.fromEntries(
	Object.entries(char_masks).map(
		([k, mask], i) => [k, mask_segs(mask, segs)]
	)
)
const char_paths_narrow = Object.fromEntries(
	Object.entries(char_masks).map(
		([k, mask], i) => [k, mask_segs(mask, narrow_segs)]
	)
)

const locale = 'en-us'

function draw_char(s, x, y, m = 1, paths = char_paths){
	paths[s].forEach(
		path => shape(path, x, y, m)
	)
}

function draw_str(chars, x, y, m = 1, paths, grid = grid_w){
	if(!(chars instanceof Array)){
		chars = (chars+'').split('')
	}
	chars.forEach((s, i) => {
		draw_char(s, x + i * grid, y, m, paths)
	})
}

function display(t){
	const weekday = t.toLocaleString(locale, {weekday:'short'}).toUpperCase().slice(0,2)
	const hours = zeropad2(t.getHours()+'')
	const minutes = zeropad2(t.getMinutes())
	const seconds = zeropad2(t.getSeconds())
	const day_of_month = (t.getDate()+'').padStart(2)

	c.fillStyle = palettes.accent
	c.clearRect(0, 0, width*z, height*z)
	let x, y, m
	m = 0.75
	x = 60
	y = 7
	draw_str(weekday, x, y, m)
	draw_str(day_of_month, x+=38, y, m)
	m = 1.5
	x = 2
	y += 8
	;(hours[0] !== '0') && draw_char(hours[0], x, y, m, char_paths_narrow)
	draw_char(hours[1], x+=grid_w-3, y, m, char_paths_narrow)
	colon(x+=grid_w-3, y, m)
	draw_str(minutes, x+=3, y, m, char_paths_narrow, grid_w-3)
	m = m*0.75
	draw_str(seconds, x+39, y+9.5, m, char_paths_narrow, grid_w-4)
}

setTheme('Standard_Light')
resize()

</script>
