<!doctype html>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width" />
<link id='favicon' rel='shortcut icon'>
<title>
	Pixel Fonts Demo
</title>
<style type="text/css">
	body, input, select {
		background: #000;
		color: #FFF;
		margin: 0;
	}
	input, select {
		border: 0;
		width: 130px;
	}
</style>

<canvas id="face"></canvas>
<br>
<input id="offset" title="Demo Offset" value="0" type="range" max="86400000" step="100000" onChange="synchronize()">
<br>
<select id="theme" title="Theme" onChange="setTheme(this.value)"></select>
<br>
<canvas id="icon"></canvas>

<script type="text/javascript">

let font = 'jag'
let palettes
const color_palettes = {
	black: {
		1: '#000',
		2: '#3F7F7F',
	},
	white: {
		1: '#FFF',
		2: '#DFFFFF',
	},
	gray: {
		1: '#7F7F7F',
		2: '#BFBFBF',
	},
	gray_dark: {
		1: '#3F3F3F',
		2: '#7F7F7F',
	},
	red: {
		1: '#800000',
		2: '#FF7F7F',
	},
	pink: {
		1: '#FF7F7F',
		2: '#FFBFBF',
	},
	orange: {
		1: '#7F3F00',
	},
	green: {
		1: '#007F00',
		2: '#7FFF7F',
	},
	cyan: {
		1: '#3F7F7F',
		2: '#7FBFBF',
	},
	blue_cyan: {
		1: '#007FFF',
		2: '#7FBFFF',
	},
	blue: {
		1: '#27278F',
	},
	indigo: {
		1: '#4F279F',
	},
	magenta: {
		1: '#804080',
		2: '#C080C0',
	},
	sky: {
		1: '#7FCFFF',
	},
	yellow: {
		1: '#7F7F3F',
		2: '#BFBF7F',
	},
}
const themes = {
	Dark: {
		background: color_palettes.black[1],
		body: color_palettes.white,
		sec: color_palettes.cyan,
		batt_hi: color_palettes.green,
		batt_mid: color_palettes.gray,
		batt_lo: color_palettes.red,
		weather: color_palettes.cyan,
		bluetooth_0: color_palettes.pink,
		bluetooth_1: color_palettes.sky,
	},
	Light: {
		background: color_palettes.sky[1],
		body: color_palettes.black,
		sec: color_palettes.cyan,
		batt_hi: color_palettes.green,
		batt_mid: color_palettes.gray_dark,
		batt_lo: color_palettes.red,
		weather: color_palettes.blue_cyan,
		bluetooth_0: color_palettes.red,
		bluetooth_1: color_palettes.blue,
	},
}
for(k in themes){
	Object.assign(themes[k], color_palettes)
}
document.getElementById('theme').innerHTML = Object.keys(themes).map(t => `<option value='${t}'>${t}</option>`).join('')


const locale = "en-us"
const months = ['JAN.', 'FEB.', 'MAR.', 'APR.', 'MAY', 'JUNE', 'JULY', 'AUG.', 'SEPT', 'OCT.', 'NOV.', 'DEC.']

const _ = void 0

const can = document.getElementById('face')
const c = can.getContext('2d')

const height = 160
const width = 130
const pad_h = 6
const pad_v = 6

// zoom dev
const z = 4
can.height = height * z
can.width = width * z
// can.style.height = height + 'px';
// can.style.width = width + 'px';
c.setTransform(z, 0, 0, z, 0, 0)

// icon
const icon_size = 32
const favicon = document.getElementById('favicon')
const icon = document.getElementById('icon')
icon.style.display = 'none'
const ic = icon.getContext('2d')
icon.height = icon.width = icon_size

const offset_el = document.getElementById('offset')

const sym_w = 5
const sym_a = sym_w * sym_w
const sym_w2 = sym_w * 2
const g = sym_w + 1
const g2 = g * 2
const tiles_h = Math.ceil(width / g * .5)
const tiles_v = Math.ceil(height / g * .5) - 1
const slots_h = Math.floor((width - pad_h) / g)
// const slots_v = Math.floor((height - pad_v) / g)

// base-2 for single color pixel font
// base-3 for 1 extra color, and so forth
// base-36 for text storage
function encode_font(font){
	return Object.fromEntries(Object.entries(font).map(([k,v])=>([k,
		parseInt(v.join('').padEnd(sym_a, '0'), 3).toString(36)
	])))
}
function fold_font(font){
	const five = /(.{5})/
	return Object.fromEntries(Object.entries(font).map(([k,v])=>([k,
		v.join('').padEnd(sym_a, '0').split(five).slice(1,-1).join('\n')
	])))
}
const fonts_decode = {}
fonts_decode.block36 = (s)=>parseInt(s, 36).toString(3).padStart(sym_a, '0').split('').map(s=>parseInt(s))
fonts_decode.blockString = (s)=>s.replace(/\s/g, '').padEnd(sym_a, '0').split('').map(s=>parseInt(s))
// const block36 = encode_font(fonts.block)
let fonts = {
	jag: {
		missing: [
			2,0,2,0,2,
			0,2,0,2,0,
			2,0,2,0,2,
			0,2,0,2,0,
			2,0,2,0,2,
		],
		' ': [],
		0: [
			0,1,1,1,0,
			1,0,0,0,1,
			1,0,2,0,1,
			1,0,0,0,1,
			0,1,1,1
		],
		1: [
			0,0,1,0,0,
			0,1,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,1,1,1
		],
		2: [
			1,1,1,1,0,
			0,0,0,0,1,
			0,1,1,1,0,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		3: [
			1,1,1,1,0,
			0,0,0,0,1,
			0,1,1,1,0,
			0,0,0,0,1,
			1,1,1,1
		],
		4: [
			0,1,0,0,1,
			1,0,0,0,1,
			1,1,1,1,0,
			0,0,0,0,1,
			0,0,0,0,1,
		],
		5: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,0,
			0,0,0,0,1,
			1,1,1,1
		],
		6: [
			0,1,1,1,0,
			1,0,0,0,0,
			1,1,1,1,0,
			1,0,0,0,1,
			0,1,1,1
		],
		7: [
			1,1,1,1,1,
			0,0,0,0,1,
			0,0,0,1,0,
			0,0,1,0,0,
			0,0,1
		],
		8: [
			0,1,1,1,0,
			1,0,0,0,1,
			0,1,1,1,0,
			1,0,0,0,1,
			0,1,1,1
		],
		9: [
			0,1,1,1,0,
			1,0,0,0,1,
			0,1,1,1,1,
			0,0,0,0,1,
			0,1,1,1
		],
		A: [
			0,1,1,1,0,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		B: [
			1,1,1,1,0,
			1,0,0,0,1,
			1,1,1,1,0,
			1,0,0,0,1,
			1,1,1,1
		],
		C: [
			0,1,1,1,1,
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			0,1,1,1,1,
		],
		D: [
			1,1,1,1,0,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1
		],
		E: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,0,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		F: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,0,
			1,0,0,0,0,
			1
		],
		G: [
			0,1,1,1,1,
			1,0,0,0,0,
			1,0,1,1,1,
			1,0,0,0,1,
			0,1,1,1,1,
		],
		H: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		I: [
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			1,1,1,1,1,
		],
		J: [
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		K: [
			1,0,0,0,1,
			1,0,0,1,0,
			1,1,1,0,0,
			1,0,0,1,0,
			1,0,0,0,1,
		],
		L: [
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		M: [
			1,1,0,1,0,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
		],
		N: [
			1,0,0,0,1,
			1,1,0,0,1,
			1,0,1,0,1,
			1,0,0,1,1,
			1,0,0,0,1,
		],
		O: [
			0,1,1,1,0,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			0,1,1,1
		],
		P: [
			1,1,1,1,0,
			1,0,0,0,1,
			1,1,1,1,0,
			1,0,0,0,0,
			1
		],
		Q: [
			1,1,1,1,0,
			1,0,0,1,0,
			1,0,0,1,0,
			1,0,0,1,0,
			1,1,1,1,1,
		],
		R: [
			1,1,1,1,0,
			1,0,0,0,1,
			1,1,1,1,0,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		S: [
			0,1,1,1,1,
			1,0,0,0,0,
			0,1,1,1,0,
			0,0,0,0,1,
			1,1,1,1
		],
		T: [
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1
		],
		U: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			0,1,1,1
		],
		V: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			0,1,0,1,0,
			0,0,1
		],
		W: [
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			0,1,0,1
		],
		X: [
			1,0,0,0,1,
			0,1,0,1,0,
			0,0,1,0,0,
			0,1,0,1,0,
			1,0,0,0,1,
		],
		Y: [
			1,0,0,0,1,
			0,1,0,1,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1
		],
		Z: [
			1,1,1,1,1,
			0,0,0,1,0,
			0,0,1,0,0,
			0,1,0,0,0,
			1,1,1,1,1,
		],
		'%': [
			1,0,0,0,1,
			0,0,0,1,0,
			0,0,1,0,0,
			0,1,0,0,0,
			1,0,0,0,1,
		],
		'*': [
			0,1,0,1,0,
			0,0,1,0,0,
			0,1,0,1
		],
		'°': [
			0,0,1,0,0,
			0,1,0,1,0,
			0,0,1
		],
		'-': [
			0,0,0,0,0,
			0,0,0,0,0,
			0,1,1,1
		],
		'.': [
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			1
		],
		':': [
			0,0,0,0,0,
			0,0,1,0,0,
			0,0,0,0,0,
			0,0,1
		],
		'[': [
			1,1,1,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,1,1
		],
		']': [
			0,0,1,1,1,
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,1,1,1,
		],
		'}': [
			0,1,1,1,0,
			0,0,0,1,0,
			0,0,0,1,1,
			0,0,0,1,0,
			0,1,1,1
		],
		_: [
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			1,1,1,1,1,
		],
		'✓': [
			0,0,0,0,0,
			0,0,0,0,1,
			0,0,0,1,0,
			1,0,1,0,0,
			0,1,
		],
		'\\': [
			1,0,0,0,0,
			0,1,0,0,0,
			0,0,1,0,0,
			0,0,0,1,0,
			0,0,0,0,1,
		],
		'': [
			1,0,1,1,0,
			0,1,1,0,1,
			0,0,1,1,0,
			0,1,1,0,1,
			1,0,1,1
		],
	},
	block: {
		missing: [
			2,2,2,2,2,
			2,2,2,0,2,
			2,0,2,0,2,
			2,0,2,2,2,
			2,2,2,2,2,
		],
		' ': [],
		0: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,2,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		1: [
			0,1,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1
		],
		2: [
			1,1,1,1,1,
			0,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		3: [
			1,1,1,1,1,
			0,0,0,0,1,
			0,1,1,1,1,
			0,0,0,0,1,
			1,1,1,1,1,
		],
		4: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
			0,0,0,0,1,
			0,0,0,0,1,
		],
		5: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,1,
			0,0,0,0,1,
			1,1,1,1,1,
		],
		6: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		7: [
			1,1,1,1,1,
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,0,0,1,
		],
		8: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		9: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
			0,0,0,0,1,
			0,0,0,0,1,
		],
		A: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		B: [
			1,1,1,1,0,
			1,0,0,1,0,
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		C: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,0,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		D: [
			1,1,1,1,0,
			1,0,0,1,1,
			1,0,0,0,1,
			1,0,0,1,1,
			1,1,1,1
		],
		E: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,0,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		F: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,0,
			1,0,0,0,0,
			1
		],
		G: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,0,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		H: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		I: [
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			1,1,1,1,1,
		],
		J: [
			0,0,0,0,1,
			0,0,0,0,1,
			0,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		K: [
			1,0,0,1,0,
			1,0,0,1,0,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		L: [
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,0,0,0,0,
			1,1,1,1,1,
		],
		M: [
			1,1,1,1,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
		],
		N: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
		],
		O: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		P: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,0,0,
			1
		],
		Q: [
			1,1,1,1,0,
			1,0,0,1,0,
			1,0,0,1,0,
			1,0,0,1,0,
			1,1,1,1,1,
		],
		R: [
			1,1,1,1,1,
			1,0,0,0,1,
			1,1,1,1,1,
			1,0,0,1,0,
			1,0,0,1,1,
		],
		S: [
			1,1,1,1,1,
			1,0,0,0,0,
			1,1,1,1,1,
			0,0,0,0,1,
			1,1,1,1,1,
		],
		T: [
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1
		],
		U: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		V: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,0,1,1,
			0,1,1,1,0,
			0,0,1
		],
		W: [
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,0,1,0,1,
			1,1,1,1,1,
		],
		X: [
			1,0,0,0,1,
			1,1,0,1,1,
			0,1,1,1,0,
			1,1,0,1,1,
			1,0,0,0,1,
		],
		Y: [
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1
		],
		Z: [
			1,1,1,1,1,
			0,0,0,1,1,
			0,1,1,1,0,
			1,1,0,0,0,
			1,1,1,1,1,
		],
		'`': [
			0,0,1,0,0,
			0,0,0,1,0,
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
		],
		'~': [
			0,0,0,0,0,
			0,1,0,0,1,
			1,0,1,0,1,
			1,0,0,1,0,
			0,0,0,0,0,
		],
		'!': [
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,1,0,0,
			0,0,0,0,0,
			0,0,1,0,0,
		],
		'@': [
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,1,1,1,
			1,0,1,0,1,
			1,0,1,1,1,
		],
		'#': [
			0,1,0,1,0,
			1,1,1,1,1,
			0,1,0,1,0,
			1,1,1,1,1,
			0,1,0,1,0,
		],
		'$': [
			1,1,1,1,1,
			1,0,1,0,0,
			1,1,1,1,1,
			0,0,1,0,1,
			1,1,1,1,1,
		],
		'%': [
			1,0,0,0,1,
			0,0,0,1,0,
			0,0,1,0,0,
			0,1,0,0,0,
			1,0,0,0,1,
		],
		'^': [
			0,0,1,0,0,
			0,1,0,1,0,
		],
		'&': [
			0,1,1,0,0,
			1,0,0,1,1,
			0,1,1,0,0,
			1,0,0,1,0,
			0,1,1,0,1,
		],
		'*': [
			0,1,0,1,0,
			0,0,1,0,0,
			0,1,0,1
		],
		'(': [
			0,0,1,1,0,
			0,1,0,0,0,
			0,1,0,0,0,
			0,1,0,0,0,
			0,0,1,1,0,
		],
		')': [
			0,1,1,0,0,
			0,0,0,1,0,
			0,0,0,1,0,
			0,0,0,1,0,
			0,1,1,0,0,
		],
		'-': [
			0,0,0,0,0,
			0,0,0,0,0,
			0,1,1,1
		],
		_: [
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			1,1,1,1,1,
		],
		'=': [
			0,0,0,0,0,
			1,1,1,1,1,
			0,0,0,0,0,
			1,1,1,1,1,
			0,0,0,0,0,
		],
		'+': [
			0,0,1,0,0,
			0,0,1,0,0,
			1,1,1,1,1,
			0,0,1,0,0,
			0,0,1,0,0,
		],
		'.': [
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			0,0,0,0,0,
			1
		],
		':': [
			0,0,0,0,0,
			0,0,1,0,0,
			0,0,0,0,0,
			0,0,1
		],
		'🔋': [
			0,1,1,1,0,
			1,1,1,1,1,
			1,0,0,0,1,
			1,0,0,0,1,
			1,1,1,1,1,
		],
		'█': [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	},
	block36: {
		"0": "5ed0ylnm",
		"1": "1lq33f70",
		"2": "5dttpvld",
		"3": "5dtquy14",
		"4": "3nw3z0r1",
		"5": "5ect57ld",
		"6": "5ect5ms4",
		"7": "5dtphl01",
		"8": "5ed1p6gv",
		"9": "5ed1or6s",
		"missing": "at74dx6q",
		" ": "0",
		"A": "5ed1p6fs",
		"B": "5cruuds4",
		"C": "5ed0ajyv",
		"D": "5cs20l3c",
		"E": "5ect4d14",
		"F": "5ect4d00",
		"G": "5ecs7gld",
		"H": "3nw3zg01",
		"I": "5dvm44ld",
		"J": "1lwj4s4",
		"K": "3r3wybi1",
		"L": "3ma63dld",
		"M": "5ef5j6g1",
		"N": "5ed0bti1",
		"O": "5ed0btj4",
		"P": "5ed1p690",
		"Q": "5crtjkcd",
		"R": "5ed1p6td",
		"S": "5ect57ld",
		"T": "5dvm44i9",
		"U": "3nw2m33d",
		"V": "3nw3ntti",
		"W": "42d7agld",
		"X": "3o35e84j",
		"Y": "3nw3z299",
		"Z": "5duggvld",
		"%": "3nd957dj",
		"-": "1dcxr",
		".": "29",
		":": "24vyvi",
		"_": "3d",
		"🔋": "1r9qb47v",
		"█": "5emavpld"
	},
	blockString: {
  "0": `
11111
10001
10201
10001
11111
`,
  "1": `
01100
00100
00100
00100
00100
`,
  "2": `
11111
00001
11111
10000
11111
`,
  "3": `
11111
00001
01111
00001
11111
`,
  "4": `
10001
10001
11111
00001
00001
`,
  "5": `
11111
10000
11111
00001
11111
`,
  "6": `
11111
10000
11111
10001
11111
`,
  "7": `
11111
00001
00001
00001
00001
`,
  "8": `
11111
10001
11111
10001
11111
`,
  "9": `
11111
10001
11111
00001
00001
`,
  "missing": `
22222
22202
20202
20222
22222
`,
  " ": `
00000
00000
00000
00000
00000
`,
  "A": `
11111
10001
11111
10001
10001
`,
  "B": `
11110
10010
11111
10001
11111
`,
  "C": `
11111
10001
10000
10001
11111
`,
  "D": `
11110
10011
10001
10011
11110
`,
  "E": `
11111
10000
11110
10000
11111
`,
  "F": `
11111
10000
11110
10000
10000
`,
  "G": `
11111
10000
10111
10001
11111
`,
  "H": `
10001
10001
11111
10001
10001
`,
  "I": `
11111
00100
00100
00100
11111
`,
  "J": `
00001
00001
00001
10001
11111
`,
  "K": `
10010
10010
11111
10001
10001
`,
  "L": `
10000
10000
10000
10000
11111
`,
  "M": `
11111
10101
10101
10101
10101
`,
  "N": `
11111
10001
10001
10001
10001
`,
  "O": `
11111
10001
10001
10001
11111
`,
  "P": `
11111
10001
11111
10000
10000
`,
  "Q": `
11110
10010
10010
10010
11111
`,
  "R": `
11111
10001
11111
10010
10011
`,
  "S": `
11111
10000
11111
00001
11111
`,
  "T": `
11111
00100
00100
00100
00100
`,
  "U": `
10001
10001
10001
10001
11111
`,
  "V": `
10001
10001
11011
01110
00100
`,
  "W": `
10101
10101
10101
10101
11111
`,
  "X": `
10001
11011
01110
11011
10001
`,
  "Y": `
10001
10001
11111
00100
00100
`,
  "Z": `
11111
00011
01110
11000
11111
`,
  "%": `
10001
00010
00100
01000
10001
`,
  "-": `
00000
00000
01110
00000
00000
`,
  ".": `
00000
00000
00000
00000
10000
`,
  ":": `
00000
00100
00000
00100
00000
`,
  "_": `
00000
00000
00000
00000
11111
`,
  "🔋": `
01110
11111
10001
10001
11111
`,
  "█": `
11111
11111
11111
11111
11111`
},
}

for(f in fonts){
	const decode = fonts_decode[f]
	if(!decode) continue
	const font = fonts[f]
	for(char in font){
		font[char] = decode(font[char])
	}
}

function setTheme(theme){
	palettes = themes[theme]
	document.getElementById('face').style.backgroundColor = palettes.background
	document.querySelector(`#theme [value=${theme}]`).selected = true
	synchronize()
}

function str(s, x, y, m = 1, p = 'body', f = font, ctx = c){
	s = [...s] // unicode
	for(var i = 0; i < s.length; ++i){
		symbol(
			s[i],
			x + i,
			y, m, p, f, ctx
		)
	}
}

function symbol(s, x, y, m, p, f, c = c){
	const font = fonts[f]
	const bmp = font[s] || font.missing || fonts.block.missing
	const l = bmp.length
	// palettes[p] || console.log('p', p, Object.keys(palettes).join())
	for(var i = 0; i < l; ++i){
		let b = bmp[i]
		if(b === 0) continue
		c.fillStyle = palettes[p][b]
		c.fillRect(
			m * (x * g + (i % sym_w)) + pad_h,
			(y * g + m * Math.floor(i / sym_w)) + pad_v,
			m, m
		)
	}
}

// display at the start of each second
function synchronize(){
	window.clearTimeout(window.synchronizeTimeout)
	const offset = Number(offset_el.value)
	// const offset = 0
	const t = new Date(Date.now() + offset)
	// const t = new Date(offset)
	display(t)
	const r = 1000 - (t % 1000)
	// window.synchronizeTimeout = window.setTimeout(synchronize, r)
}

function zeropad2(s){
	return ('0' + s).slice(-2)
}

function display(t){
	const month = months[t.getMonth()]
	// const month = t.toLocaleString(locale, { month: 'short' }).toUpperCase()
	const weekday = t.toLocaleString(locale, { weekday: 'long' }).toUpperCase()
	const hours = t.getHours()
	const minutes = t.getMinutes()
	const time = zeropad2(hours) + ':' + zeropad2(minutes)
	const seconds = zeropad2(t.getSeconds())
	const numdate =
		t.getFullYear()+
		'-'+
		zeropad2(t.getMonth() + 1)+
		'-'+
		zeropad2(t.getDate())

	c.clearRect(0, 0, width, height)

	const tiles = tiles_h * tiles_v
	for(var i = 0; i < tiles; ++i){
		c.fillStyle = 'rgba('+
			Array(3).fill(
				((i+1) % 2) * Math.floor(Math.random() * 256)
			).concat(.1).join()
			+')'
		c.fillRect(
			i % tiles_h * g2,
			Math.floor(i / tiles_h) * g2,
			sym_w2, sym_w2
		)
	}

	let x = y = 0, m = 1


	let chars
	chars = Object.keys(fonts.jag)
	for(var i = 0; i < chars.length / slots_h; ++i){
		str(
			chars.slice(
				i * slots_h,
				(i+1) * slots_h
			),
			0,
			y+i
		)
	}
	y += 3
	
	chars = Object.keys(fonts.block)
	for(var i = 0; i < chars.length / slots_h; ++i){
		str(
			chars.slice(
				i * slots_h,
				(i+1) * slots_h
			),
			0,
			y+i,
			_,
			_,
			'block'
		)
	}
	y += 3

	// chars = Object.keys(fonts.block36)
	// for(var i = 0; i < chars.length / slots_h; ++i){
	// 	str(
	// 		chars.slice(
	// 			i * slots_h,
	// 			(i+1) * slots_h
	// 		),
	// 		0,
	// 		y+i,
	// 		_,
	// 		_,
	// 		'block36'
	// 	)
	// }
	// y += 3

	str(month, 10, y)
	str(weekday.slice(0,3)+'.', 16, y)
	str(numdate, 0, y+=1, 2)
	str(time, 0, y+=3, 4, _, 'block')
	// str(seconds, 3, y+=4, 4, 'sec', 'block')
	// str(weekday, 0, y+=5, 2, 'yellow')
	// str(weekday, 0, y+=5, 2, _, 'block')
	y += 4

	const ms_day = 864e5
	const ms_centiday = 864e3
	const weathers = ['CLOUD', 'SNOW', 'FOG', 'RAIN', 'FAIR', 'SUNNY']
	const temperature = (t % ms_day) / ms_centiday
	const weather = weathers[Math.floor(temperature / 100 * weathers.length)]
	// const s = Math.round(temperature + 1) +'°F'
	const s = Math.round((temperature-32)/1.8)+'°C'
	// str(s.slice(0, 4) + ' ' + weather, 0, y+=2, 2, 'weather')
	// y = -3
	// for(var i=0; i < 6; ++i){
	// 	const temperature = i*100/6
	// 	const s = Math.round(temperature + 1) +'°F'
	// 	const weather = weathers[Math.floor(temperature / 100 * weathers.length)]
	// 	str(s.slice(0, 4) + ' ' + weather, 0, y+=4, 2, 'weather')
	// }
	// y = -1
	// for(var i=1; i < 7; ++i){
	// 	const temperature = i*100/6-.01
	// 	const s = Math.round(temperature + 1) +'°F'
	// 	const weather = weathers[Math.floor(temperature / 100 * weathers.length)]
	// 	str(s.slice(0, 4) + ' ' + weather, 0, y+=4, 2, 'weather')
	// }

	const battery = 100 - Math.floor((t % 864e5) / 864e3)
	const batt_s = `🔋${(' '+battery).slice(-2)}%`
	const batt_c = 'batt_' + ['lo', 'mid', 'hi'][Math.floor(battery * .0299)]
	str(batt_s, 0, y, 2, batt_c, 'block')
	x = batt_s.length

	const bluetooth = Math.floor(hours / 12)
	m = 2
	const bt_color = 'bluetooth_'+bluetooth
	str('', x, y, m, bt_color)
	;(bluetooth
		? str('✓' , x+=1, y, m, bt_color)
		: str('\\', x+=1, y, m, bt_color)
	)

	// {
	// 	let y = 19, m = 2, x = -0.5, f = 'jag', c = 'indigo'
	// 	str('R', x+=1, y, m, 'red', f)
	// 	str('APHAEL ', x+=1, y, m, c, f)
	// 	str('B', x+=7, y, m, 'blue', f)
	// }

	{
		let y = 21, m = 2, x = 1.5, f = 'block'
		str('R', x+=1, y, m, 'red', f)
		str('O', x+=1, y, m, 'orange', f)
		str('Y', x+=1, y, m, 'yellow', f)
		str('G', x+=1, y, m, 'green', f)
		str('C', x+=1, y, m, 'cyan', f)
		str('B', x+=1, y, m, 'blue', f)
		str('I', x+=1, y, m, 'indigo', f)
		str('M', x+=1, y, m, 'magenta', f)
	}

	// {
	// 	let y = 23, m = 10, x = .3, s = '█', f = 'block'
	// 	str(s, x+=.2, y, m, 'red', f)
	// 	str(s, x+=.2, y, m, 'orange', f)
	// 	str(s, x+=.2, y, m, 'yellow', f)
	// 	str(s, x+=.2, y, m, 'green', f)
	// 	str(s, x+=.2, y, m, 'cyan', f)
	// 	str(s, x+=.2, y, m, 'blue', f)
	// 	str(s, x+=.2, y, m, 'indigo', f)
	// 	str(s, x+=.2, y, m, 'magenta', f)
	// }

	ic.clearRect(0, 0, icon_size, icon_size)
	str(`${zeropad2(hours)}`, 0, 0, 2, 'white', 'block', ic)
	str(`${zeropad2(minutes)}`, 0, 2, 2, 'white', 'block', ic)
	favicon.href = icon.toDataURL('image/png')
}

setTheme('Dark')

synchronize()

</script>
